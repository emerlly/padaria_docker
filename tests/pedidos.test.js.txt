const axios = require('axios');
const express = require('express');
const app = express();
app.use(express.json());

describe('Teste de criação de pedidos', () => {
    it('Deve criar um pedido', async () => {
        // Cria um objeto com os dados do pedido
        const pedido = {
            clienteId: 5,  // Use um cliente ID válido
            status: "pendente",
            valorTotal: 120.00,
            items: [
                {
                    produtoId: 11,
                    quantidade: 2,
                    precoUnitario: 20.00
                },
                {
                    produtoId: 12,
                    quantidade: 1,
                    precoUnitario: 100.00
                }
            ]
        };

        // Envia a requisição para a API de pedidos
        const response = await axios.post('http://localhost:3000/orders', pedido, {
            headers: { 'Content-Type': 'application/json' }
        });

        // Verifica se a resposta contém os dados do pedido
        expect(response.data).toHaveProperty('message', 'Pedido e itens cadastrados com sucesso!');
        expect(response.data).toHaveProperty('orderId');
        // Verifica se o status da resposta é 201 (criado)
        expect(response.status).toBe(201);
    });
});
